{# src/UserManagementBundle/Resources/views/form/new.html.twig #}

{% extends 'UserManagementBundle:user:index.html.twig' %}

{% block messages %}
{% for message in app.flashes('success') %}
    <div class="alert alert-notice">
        {{ message }}
    </div>
{% endfor %}
{% endblock %}

{% block body %}
<div id="new_form">
{{ form_start(form, {'attr':{'novalidate' : 'novalidate','id':'myform'}}) }}
<table align="center">
    <tr>
        <td>
            {{ form_label(form.username) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.username) }}</p>
            <span class="error">{{ form_errors(form.username) }}</span>
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.firstname) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.firstname) }}</p>
            <span class="error">{{ form_errors(form.firstname) }}</span>
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.lastname) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.lastname) }}</p>
            <span class="error">{{ form_errors(form.lastname) }}</span>
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.gender) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.gender) }}</p>
            <span class="error">{{ form_errors(form.gender) }}</span>
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.blood) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.blood) }}</p>
            <span class="error">{{ form_errors(form.blood) }}</span>
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.dob) }}
        </td>
        <td>
            <p class="widget">{{ form_widget(form.dob) }}</p>
            <span class="error">{{ form_errors(form.dob) }}</span>
        </td>
    </tr>
  
    <tr>
        <td>
            {{ form_label(form.emails) }}
        </td>
        <td>

        <ul id="email-fields-list"
            data-prototype="{{ form_widget(form.emails.vars.prototype)|e }}">
            {% for emailField in form.emails %}
                <p>
                    <p class="widget">{{ form_widget(emailField) }}<p>
                    <span class="error">{{ form_errors(emailField) }}</span>
                </p>
            {% endfor %}
        </ul>
        </td>
    </tr>
    <tr>
        <td></td>
        <td>
        <input type="button" value="Add another email" id="add-another-email" onclick="addField('email-fields-list')">
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.mobileNumbers) }}
        </td>
        <td>

        <ul id="mobile-numbers-list"
            data-prototype="{{ form_widget(form.mobileNumbers.vars.prototype)|e }}">
            {% for mobileField in form.mobileNumbers %}
                <p>
                    <p class="widget">{{ form_widget(mobileField) }}</p>
                    <span class="error">{{ form_errors(mobileField) }}</span>

                </p>
            {% endfor %}
        </ul>
        </td>
    </tr>
    <tr>
        <td></td>
        <td>
        <input type="button" value="Add another Number" id="add-another-number" onclick="addField('mobile-numbers-list')">
        </td>
    </tr>
    <tr>
        <td>
            {{ form_label(form.education) }}
        </td>
        <td>

        <ul id="education-list"
            data-prototype="{{ form_widget(form.education.vars.prototype)|e }}">
            {% for edu in form.education %}
                <p>
                    <p class="widget">{{ form_widget(edu.eduType) }}</p>
                    <span class="error">{{ form_errors(edu.eduType) }}</span>
                    <p class="widget">{{ form_widget(edu.institute, {'attr':{'placeholder': 'Institute'}}) }}</p>
                    <span class="error">{{ form_errors(edu.institute) }}</span>
                </p>
            {% endfor %}
        </ul>
        </td>
    </tr>
    <tr>
        <td></td>
        <td>
        <input type="button" value="Add another Education" id="add-another-education" onclick="addField('education-list')">
        </td>
    </tr>
    
    <tr>
        <td>
            {{ form_label(form.interests) }}
        </td>
        <td>

        <ul id="interests-list"
            data-prototype="{{ form_widget(form.interests.vars.prototype)|e }}">
            {% for interestfield in form.interests %}
                <p>
                    <p class="widget">{{ form_widget(interestfield.interest) }}</p>
                    <span class="error">{{ form_errors(interestfield.interest) }}</span>
                </p>
            {% endfor %}
        </ul>
        </td>
    </tr>
    <tr>
        <td></td>
        <td>
        <input type="button" value="Add another interest" id="add-another-interest" onclick="addField('interests-list')">
        </td>
    </tr>
    <tr>
        <td>
        </td>
        <td>
            {{ form_row(form.save) }}
        </td>
    </tr>
    </table>
            {{ form_row(form._token) }}

{{ form_end(form, {'render_rest': false}) }}
</div>
{% endblock %}


{% block javascripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/additional-methods.min.js"></script>
    <script src="{{ asset('bundles/usermanagement/js/addRemoveField.js') }}"></script>
    <script>
        $(document).ready(function() {
            var today = new Date();
            var currentYear = today.getFullYear();
            //var rangeLimit = currentYear-18;
            $( ".js-datepicker" ).datepicker({
                changeMonth: true,
                changeYear: true,
                yearRange: '1980:'+currentYear,
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $("#myform").validate({
                rules: {
                    'user[username]': {
                        required: true,
                        pattern: /^(\w+)$/,
                    },
                    'user[firstname]': {
                        required: true,
                        pattern: /^([a-zA-Z]+)([ \.-][a-zA-Z]+)?$/,
                    },
                    'user[lastname]': {
                        required: false,
                        pattern: /^([a-zA-Z]+)([ \.-][a-zA-Z]+)?$/,
                    },
                    'user[dob]': {
                        required: true,
                        pattern: /^[\d]{2}[/][\d]{2}[/][\d]{4}$/,
                    },
                    '{{ form.blood.vars.full_name }}': {
                         required: true,
                     }, 
                  },
                messages: {
                    'user[username]': {
                        required: "Please enter your username",
                        pattern: "Please enter valid username"
                    },
                    'user[firstname]': {
                        required: "Please enter your firstname",
                        pattern: "Please enter valid firstname"
                    },
                    'user[lastname]': {
                        pattern: "Please enter valid lastname"
                    },
                    'user[dob]': {
                        required: "Please enter your dob",
                        pattern: "Please enter valid dob",
                    },
                    '{{ form.blood.vars.full_name }}': {
                        required: "Please select Blood group",
                    }, 
                  }        
            });            
            jQuery.validator.addClassRules({
                "email_id": {
                    required: true,
                    pattern: /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,
                },
                "phone_number": {
                    required: true,
                    pattern: /^([9|8|7])[\d]{9}$/,
                },
                "education_type": {
                    required: true,
                },
                "interest_area": {
                    required: true,
                },
                "institute": {
                    required: true,
                    pattern: /^[A-z]+$/,
                },
            });
        });
    </script>
    
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <style>
        div.email_id, div.phone_number, div.education_type, div.interest_area {
            display:inline-block;
        }
        .error {
            color: teal;
        }
        form {
            padding:20px 20px;
            display:block;
            text-align: center;
        }
        td > ul {
            padding:0%;
            margin:0%;
        }
    </style>
{% endblock %}
        